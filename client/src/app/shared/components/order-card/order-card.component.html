<div
  class="order-card"
  [class.hidden-order]="order?.hidden"
  [class.sell-card]="isSelling"
  [class.buy-card]="!isSelling"
  [class.compact-card]="compact"
  [class.menu-open]="menuOpen"
>
  <!-- Main Row: Item + Qty + Price -->
  <div class="order-main">
    <!-- Item Thumbnail & Qty -->
    <div class="order-item" (click)="onItemClick()">
      <img class="order-img" [src]="imageSource" [alt]="order?.name" />
    </div>

    <div class="order-qty">
      <span class="qty-value">{{ order?.quantity }}</span>
      <span class="qty-label">qty</span>
    </div>

    <!-- Item Info -->
    <div class="order-info">
      <span class="order-name" [title]="order?.name" (click)="onItemClick()">{{ order?.name }}</span>
      <app-item-details *ngIf="showDetails" [item]="order" [details]="order?.item"></app-item-details>
      <span class="desc-preview" *ngIf="order?.description && showDetails">{{ order.description }}</span>
    </div>

    <!-- Price -->
    <div class="order-price">
      <div class="price-row" *ngFor="let price of order?.prices">
        <img class="price-icon" [src]="price.type | currencySource" />
        <span class="price-amount">{{ price.price }}</span>
      </div>
    </div>

    <!-- Actions (full) -->
    <div class="order-actions" *ngIf="!locked && !compact">
      <button class="action-btn edit" (click)="onEditClick()" title="Edit">
        <i class="fa fa-pen"></i>
      </button>
      <button
        class="action-btn visibility"
        [class.active]="order?.hidden"
        (click)="onHideClick()"
        [title]="order?.hidden ? 'Show' : 'Hide'"
      >
        <i class="fa" [class.fa-eye]="!order?.hidden" [class.fa-eye-slash]="order?.hidden"></i>
      </button>
      <button
        class="action-btn success"
        [class.confirm]="order?.completed"
        (click)="onCompleteClick()"
        (mouseleave)="onCompleteLeave()"
        [title]="completeTitle"
      >
        <i class="fa fa-check"></i>
      </button>
      <button
        class="action-btn danger"
        [class.confirm]="order?.removed"
        (click)="onRemoveClick()"
        (mouseleave)="onRemoveLeave()"
        title="Remove"
      >
        <i class="fa fa-trash"></i>
      </button>
    </div>

    <!-- Actions (compact dropdown) -->
    <div class="order-actions-compact" *ngIf="!locked && compact">
      <button class="action-btn menu-btn" (click)="toggleMenu($event)" title="Actions">
        <i class="fa fa-ellipsis-v"></i>
      </button>
      <div class="actions-dropdown" *ngIf="menuOpen" (click)="$event.stopPropagation()">
        <div class="dropdown-inner">
          <button class="dropdown-item" (click)="onEditClick(); closeMenu()">
            <i class="fa fa-pen"></i> Edit
          </button>
          <button class="dropdown-item" (click)="onHideClick(); closeMenu()">
            <i class="fa" [class.fa-eye]="!order?.hidden" [class.fa-eye-slash]="order?.hidden"></i>
            {{ order?.hidden ? 'Show' : 'Hide' }}
          </button>
          <button
            class="dropdown-item success"
            [class.confirm]="order?.completed"
            (click)="onCompleteClick()"
            (mouseleave)="onCompleteLeave()"
          >
            <i class="fa fa-check"></i> {{ completeTitle }}
          </button>
          <button
            class="dropdown-item danger"
            [class.confirm]="order?.removed"
            (click)="onRemoveClick()"
            (mouseleave)="onRemoveLeave()"
          >
            <i class="fa fa-trash"></i> Remove
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
