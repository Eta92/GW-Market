<div class="shop-page scroll font-fritz">
  <!-- SITE HEADER (Navigation Only) -->
  <app-header
    [showSearch]="true"
    [showFeatures]="false"
    [compact]="true"
    (placeOrder)="orderOpen = true"
    (selectItem)="goToItem($event.name)"
  ></app-header>

  <!-- MAIN LAYOUT: Sidebar + Content -->
  <div class="page-layout">
    <!-- SHOP SIDEBAR (Left on desktop, top on mobile) -->
    <aside class="shop-sidebar">
      <div class="sidebar-inner">
        <!-- Player Visual -->
        <div class="player-visual">
          <div class="player-frame" [class.live]="showCandle">
            <div class="player-avatar">
              <i class="fa fa-user"></i>
            </div>
            <div class="live-indicator" *ngIf="showCandle">
              <span class="live-dot"></span>
            </div>
          </div>
        </div>

        <!-- Player Info -->
        <div class="player-info">
          <span class="player-label">{{ showcase ? 'SHOP OF' : showCandle ? 'SHOP LIVE' : 'MY SHOP' }}</span>
          <h1 class="player-name">{{ shop?.player || 'No Player' }}</h1>
          <div class="player-badges" *ngIf="shop?.daybreakOnline || shop?.authCertified">
            <span class="badge online" *ngIf="shop?.daybreakOnline">
              <img src="../../../assets/img/online.png" /> Online
            </span>
            <span class="badge certified" *ngIf="shop?.authCertified">
              <img src="../../../assets/img/certified.png" /> Certified
            </span>
          </div>
        </div>

        <!-- Timer (when live) -->
        <div class="sidebar-timer" *ngIf="showCandle && !showcase">
          <div class="timer-header">
            <i class="fa fa-clock"></i>
            <span class="timer-label">Online time</span>
          </div>
          <span class="timer-value">{{ formatTime(timeLeft) }}</span>
          <div class="timer-bar">
            <div class="timer-fill" [style.width.%]="(timeLeft / (15 * 60 * 1000)) * 100"></div>
          </div>
          <button class="shop-toggle-btn shop-refresh-btn" (click)="refreshShop()">
            <i class="fa fa-refresh"></i>
            <span class="shop-refresh-text">{{ 'Refresh shop' }}</span>
          </button>
        </div>

        <!-- Enable/Stop Toggle -->
        <button
          *ngIf="!showcase"
          class="shop-toggle-btn"
          [class.active]="showCandle"
          (click)="showCandle ? stopShop() : refreshShop()"
        >
          <i class="fa" [class.fa-power-off]="!showCandle" [class.fa-stop]="showCandle"></i>
          <span>{{ showCandle ? 'Stop shop' : 'Update shop' }}</span>
        </button>

        <!-- Quick Stats -->
        <div class="sidebar-stats">
          <div class="stat-row">
            <span class="stat-icon sell"><i class="fa fa-arrow-up"></i></span>
            <span class="stat-label">Selling</span>
            <span class="stat-value">{{ sellOrders?.length || 0 }}</span>
          </div>
          <div class="stat-row">
            <span class="stat-icon buy"><i class="fa fa-arrow-down"></i></span>
            <span class="stat-label">Buying</span>
            <span class="stat-value">{{ buyOrders?.length || 0 }}</span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div *ngIf="!showcase" class="sidebar-actions">
          <button class="sidebar-action-btn" [class.warning]="playerWarning" (click)="openPlayer()">
            <i class="fa fa-user"></i>
            <span>Player</span>
          </button>
          <button class="sidebar-action-btn" (click)="import.click()">
            <i class="fa fa-upload"></i>
            <span>Import</span>
          </button>
          <input #import class="hidden" type="file" accept=".json" (change)="onImport($event)" />
          <button class="sidebar-action-btn" (click)="exportShop()">
            <i class="fa fa-download"></i>
            <span>Export</span>
          </button>
          <button class="sidebar-action-btn danger" (click)="clearShop = true">
            <i class="fa fa-fire"></i>
            <span>New</span>
          </button>
          <button class="sidebar-action-btn col-span-2" (click)="getLink()">
            <i class="fa fa-link"></i>
            <span>Public Link</span>
          </button>

          <textarea *ngIf="showLink" class="sidebar-action-btn col-span-2" #area (focus)="area.select()" readonly>
https://gwmarket.net/shop/showcase?public={{ shop.publicId }}</textarea
          >
        </div>

        <!-- Clear Confirmation -->
        <div class="confirm-inline" *ngIf="clearShop">
          <span class="confirm-warning">
            <i class="fa fa-exclamation-triangle"></i>
            Destroy all?
          </span>
          <div class="confirm-buttons">
            <button class="confirm-btn yes" (click)="onClearShop()">Yes</button>
            <button class="confirm-btn no" (click)="clearShop = false">No</button>
          </div>
        </div>
      </div>
    </aside>

    <!-- CONTENT AREA -->
    <div class="content-area">
      <!-- FILTER BAR -->
      <section class="filter-bar">
        <app-filter-order (updateFilter)="onFilterChange($event)"></app-filter-order>
        <div class="view-options">
          <button
            class="view-option-btn"
            [class.active]="compactView"
            (click)="compactView = !compactView"
            title="Display your orders in a multi-column grid layout. Cards are smaller with a 3-dot menu for actions. Great for managing large inventories."
          >
            <i class="fa fa-th"></i>
          </button>
          <button
            class="view-option-btn"
            [class.active]="showDetails"
            (click)="showDetails = !showDetails"
            title="Toggle item details like weapon requirements, inscriptions, and miniature status. Hide them for a cleaner, uniform look."
          >
            <i class="fa fa-tags"></i>
          </button>
        </div>
        <div class="filter-summary">
          <span class="order-total">{{ (sellOrders?.length || 0) + (buyOrders?.length || 0) }} orders</span>
        </div>
      </section>

      <!-- ORDERS SECTION -->
      <main class="orders-section bg-sky bg-base">
        <div class="orders-grid">
          <!-- Sell Orders Column -->
          <div
            class="orders-column sell-column"
            [class.hidden]="orderFilter.orderType === 'buy'"
            [class.full-width]="orderFilter.orderType === 'sell' || compactView"
            [class.compact-column]="compactView"
          >
            <h2 class="column-title">
              <i class="fa fa-arrow-up"></i>
              Sell orders
              <span class="order-count" *ngIf="sellOrders?.length">({{ sellOrders.length }})</span>
            </h2>

            <div class="orders-list scroll" *ngIf="sellOrders?.length > 0">
              <app-order-card
                *ngFor="let order of sellOrders"
                [locked]="showcase"
                [compact]="compactView || orderFilter.orderType === 'sell'"
                [showDetails]="showDetails"
                [order]="order"
                [imageSource]="getImageSource(order.name)"
                [priceLabel]="'ASKING'"
                (itemClick)="goToItem($event)"
                (editClick)="editOrder($event)"
                (hideClick)="onHideOrder($event)"
                (completeClick)="onCompleteOrder($event)"
                (completeLeave)="onCompleteLeave($event)"
                (removeClick)="onRemoveOrder($event)"
                (removeLeave)="onRemoveLeave($event)"
              ></app-order-card>
            </div>

            <div class="empty-orders" *ngIf="!sellOrders?.length">
              <i class="fa fa-store"></i>
              <p>No sell orders</p>
            </div>
          </div>

          <!-- Buy Orders Column -->
          <div
            class="orders-column buy-column"
            [class.hidden]="orderFilter.orderType === 'sell'"
            [class.full-width]="orderFilter.orderType === 'buy' || compactView"
            [class.compact-column]="compactView"
          >
            <h2 class="column-title">
              <i class="fa fa-arrow-down"></i>
              Buy orders
              <span class="order-count" *ngIf="buyOrders?.length">({{ buyOrders.length }})</span>
            </h2>

            <div class="orders-list scroll" *ngIf="buyOrders?.length > 0">
              <app-order-card
                *ngFor="let order of buyOrders"
                [order]="order"
                [locked]="showcase"
                [compact]="compactView || orderFilter.orderType === 'buy'"
                [showDetails]="showDetails"
                [imageSource]="getImageSource(order.name)"
                [priceLabel]="'PAYING'"
                (itemClick)="goToItem($event)"
                (editClick)="editOrder($event)"
                (hideClick)="onHideOrder($event)"
                (completeClick)="onCompleteOrder($event)"
                (completeLeave)="onCompleteLeave($event)"
                (removeClick)="onRemoveOrder($event)"
                (removeLeave)="onRemoveLeave($event)"
              ></app-order-card>
            </div>

            <div class="empty-orders" *ngIf="!buyOrders?.length">
              <i class="fa fa-shopping-cart"></i>
              <p>No buy orders</p>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <app-footer></app-footer>
</div>

<!-- Edit Order Modal -->
<app-modal [isOpen]="!!orderEdit" (closed)="orderEdit = null">
  <app-edit-order
    [original]="orderEdit"
    [confirm]="'Edit Order'"
    [maskSearch]="true"
    (closeEdit)="orderEdit = null"
    (confirmOrder)="onEditOrder($event)"
  ></app-edit-order>
</app-modal>

<!-- New Order Component -->
<app-new-order
  [warning]="orderWarning"
  [orderOpen]="orderOpen"
  (createOrder)="onCreateOrder($event)"
  (closeOrder)="orderOpen = false"
></app-new-order>

<!-- Player Selection Modal -->
<app-modal [isOpen]="playerOpen" (closed)="playerOpen = false">
  <app-active-player
    [shop]="shop"
    (closeEdit)="playerOpen = false"
    (confirmPlayer)="onConfirmPlayer($event)"
  ></app-active-player>
</app-modal>
